import{_ as M,r as y,b as f,d as R,c as D,e as F,f as o,w as r,g as B,t as T,h as m,o as k,i as g,F as x,j as z,k as j}from"./index-Coh5NWso.js";const P={name:"user",setup(){const{proxy:s}=B(),l=y({state:0}),h=f([]),e=y({pageNum:1,pageSize:10}),_=f([]),C=f(!1),p=y({userName:"",userEmail:"",mobile:"",job:"",state:3,roleList:[],deptId:[]}),n=f([]),u=f([]),V=f("add"),c=y({userName:[{required:!0,message:"用户名不能为空",trigger:"blur"}],userEmail:[{required:!0,message:"邮箱不能为空",trigger:"blur"}],mobile:[{required:!0,message:"手机号不能为空",trigger:"blur"},{pattern:/1\d{10}/,message:"请输入正确格式的手机号",trigger:"blur"}],deptId:[{required:!0,message:"部门不能为空",trigger:"blur"}]}),w=y([{label:"用户ID",prop:"userId"},{label:"用户名",prop:"userName"},{label:"用户邮箱",prop:"userEmail"},{label:"用户角色",prop:"role",formatter(t,d,b){return{0:"管理员",1:"普通用户"}[b]}},{label:"用户状态",prop:"state",formatter(t,d,b){return{1:"在职",2:"离职",3:"试用期"}[b]}},{label:"注册时间",prop:"createTime"},{label:"最后登录时间",prop:"lastLoginTime"}]);R(()=>{i(),S(),E()});const i=async()=>{let t={...l,...e};try{const{list:d,page:b}=await s.$api.getUserList(t);h.value=d,e.total=b.total}catch(d){console.log("error",d)}},L=()=>{i()},v=t=>{s.$refs[t].resetFields()},I=t=>{e.pageNum=t,i()},N=async t=>{await s.$api.userDel({userIds:[t.userId]}),s.$message.success("删除成功"),i()},a=async()=>{if(_.value.length===0){s.$message.error("请选择要删除的用户");return}(await s.$api.userDel({userIds:_.value})).nModified>0?(s.$message.success("删除成功"),i()):s.$message.error("删除失败")},U=t=>{let d=[];t.map(b=>{d.push(b.userId)}),_.value=d},q=()=>{C.value=!0},S=async()=>{let t=await s.$api.getDeptList();console.log("deptList=",t),u.value=t},E=async()=>{let t=await s.$api.getRoleList();console.log("roleList=",t),n.value=t.list};return{user:l,showModal:C,userForm:p,rules:c,userList:h,columns:w,pager:e,checkedUserIds:_,getUserList:i,handleCurrentChange:I,handleQuery:L,handleReset:v,handleDelete:N,handlePatchDel:a,handleSelectionChange:U,handleCreate:q,getDeptList:S,getRoleList:E,roleList:n,deptList:u,handleClose:()=>{C.value=!1,v("dialogForm")},handleSubmit:()=>{console.log("userForm=",p),s.$refs.dialogForm.validate(async t=>{if(t){let d=T(p);d.userEmail+="@imooc.com",d.action=V.value,console.log("params=",d),await s.$api.userSubmit(d)&&(C.value=!1,s.$message.success("用户创建成功"),v("dialogForm"),i())}})}}}},Q={class:"user-manage"},A={class:"query-form"},G={class:"base-table"},H={class:"action"},J={class:"dialog-footer"};function K(s,l,h,e,_,C){const p=m("el-input"),n=m("el-form-item"),u=m("el-option"),V=m("el-select"),c=m("el-button"),w=m("el-form"),i=m("el-table-column"),L=m("el-table"),v=m("el-pagination"),I=m("el-cascader"),N=m("el-dialog");return k(),D("div",Q,[F("div",A,[o(w,{ref:"form",inline:!0,model:e.user,class:"form-inline"},{default:r(()=>[o(n,{label:"用户ID",prop:"userId"},{default:r(()=>[o(p,{modelValue:e.user.userId,"onUpdate:modelValue":l[0]||(l[0]=a=>e.user.userId=a),placeholder:"请输入用户ID"},null,8,["modelValue"])]),_:1}),o(n,{label:"用户名称",prop:"userName"},{default:r(()=>[o(p,{modelValue:e.user.userName,"onUpdate:modelValue":l[1]||(l[1]=a=>e.user.userName=a),placeholder:"请输入用户昵称"},null,8,["modelValue"])]),_:1}),o(n,{label:"状态",prop:"state"},{default:r(()=>[o(V,{modelValue:e.user.state,"onUpdate:modelValue":l[2]||(l[2]=a=>e.user.state=a),placeholder:"请选择状态",clearable:""},{default:r(()=>[o(u,{value:0,label:"所有"}),o(u,{value:1,label:"在职"}),o(u,{value:2,label:"离职"}),o(u,{value:3,label:"试用期"})]),_:1},8,["modelValue"])]),_:1}),o(n,null,{default:r(()=>[o(c,{type:"primary",onClick:e.handleQuery},{default:r(()=>l[12]||(l[12]=[g("查询")])),_:1},8,["onClick"]),o(c,{onClick:l[3]||(l[3]=a=>e.handleReset("form"))},{default:r(()=>l[13]||(l[13]=[g("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),F("div",G,[F("div",H,[o(c,{type:"primary",onClick:e.handleCreate},{default:r(()=>l[14]||(l[14]=[g("新增")])),_:1},8,["onClick"]),o(c,{type:"danger",onClick:e.handlePatchDel},{default:r(()=>l[15]||(l[15]=[g("批量删除")])),_:1},8,["onClick"])]),o(L,{data:e.userList,onSelectionChange:e.handleSelectionChange},{default:r(()=>[o(i,{type:"selection",width:"55"}),(k(!0),D(x,null,z(e.columns,a=>(k(),j(i,{key:a.prop,prop:a.prop,label:a.label,width:a.width,formatter:a.formatter},null,8,["prop","label","width","formatter"]))),128)),o(i,{label:"操作",width:"130"},{default:r(a=>[o(c,{onClick:U=>s.handleClick(a.row),size:"small"},{default:r(()=>l[16]||(l[16]=[g("编辑")])),_:2},1032,["onClick"]),o(c,{type:"danger",size:"small",onClick:U=>e.handleDelete(a.row)},{default:r(()=>l[17]||(l[17]=[g("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"]),o(v,{class:"pagination",background:"",layout:"prev, pager, next",total:e.pager.total,"page-size":e.pager.pageSize,"current-page":e.pager.pageNum,onCurrentChange:e.handleCurrentChange},null,8,["total","page-size","current-page","onCurrentChange"])]),o(N,{title:"用户新增",modelValue:e.showModal,"onUpdate:modelValue":l[11]||(l[11]=a=>e.showModal=a)},{footer:r(()=>[F("div",J,[o(c,{onClick:e.handleClose},{default:r(()=>l[19]||(l[19]=[g("取消")])),_:1},8,["onClick"]),o(c,{type:"primary",onClick:e.handleSubmit},{default:r(()=>l[20]||(l[20]=[g("确定")])),_:1},8,["onClick"])])]),default:r(()=>[o(w,{ref:"dialogForm",model:e.userForm,"label-width":"100px",rules:e.rules},{default:r(()=>[o(n,{label:"用户名",prop:"userName"},{default:r(()=>[o(p,{modelValue:e.userForm.userName,"onUpdate:modelValue":l[4]||(l[4]=a=>e.userForm.userName=a),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),o(n,{label:"邮箱",prop:"userEmail"},{default:r(()=>[o(p,{modelValue:e.userForm.userEmail,"onUpdate:modelValue":l[5]||(l[5]=a=>e.userForm.userEmail=a),placeholder:"请输入用户邮箱"},{append:r(()=>l[18]||(l[18]=[g("@imooc.com")])),_:1},8,["modelValue"])]),_:1}),o(n,{label:"手机号",prop:"mobile"},{default:r(()=>[o(p,{modelValue:e.userForm.mobile,"onUpdate:modelValue":l[6]||(l[6]=a=>e.userForm.mobile=a),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),o(n,{label:"岗位",prop:"job"},{default:r(()=>[o(p,{modelValue:e.userForm.job,"onUpdate:modelValue":l[7]||(l[7]=a=>e.userForm.job=a),placeholder:"请输入岗位"},null,8,["modelValue"])]),_:1}),o(n,{label:"状态",prop:"state"},{default:r(()=>[o(V,{modelValue:e.userForm.state,"onUpdate:modelValue":l[8]||(l[8]=a=>e.userForm.state=a)},{default:r(()=>[o(u,{value:1,label:"在职"}),o(u,{value:2,label:"离职"}),o(u,{value:3,label:"试用期"})]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"系统角色",prop:"roleList"},{default:r(()=>[o(V,{modelValue:e.userForm.roleList,"onUpdate:modelValue":l[9]||(l[9]=a=>e.userForm.roleList=a),placeholder:"请选择用户系统角色",multiple:"",style:{width:"100%"}},{default:r(()=>[(k(!0),D(x,null,z(e.roleList,a=>(k(),j(u,{key:a._id,label:a.roleName,value:a._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"部门",prop:"deptId"},{default:r(()=>[o(I,{modelValue:e.userForm.deptId,"onUpdate:modelValue":l[10]||(l[10]=a=>e.userForm.deptId=a),placeholder:"请选择所属部门",options:e.deptList,props:{checkStrictly:!0,value:"_id",label:"deptName"},"show-all-levels":!0,style:{width:"100%"},clearable:""},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const Y=M(P,[["render",K],["__scopeId","data-v-92f11bbf"]]);export{Y as default};
